$$.aUser={userId:null,activeSpan:'<i class="large material-icons" style="color: blue">check</i>',unactiveSpan:'<i class="large material-icons" style="color: gray">close</i>',init:function(){$("#menuUser").append('<span class="sr-only">(current)</span>').parent().addClass("active"),$("#userModal").on("shown.bs.modal",function(){$("#username").focus()}),$("#userInfoModal").on("shown.bs.modal",function(){$("#username").focus()}),$("#navbarSupportedContent ul").append('<li class="nav-item navbar-toggler-right" style="margin-right: 60px">   <a class="nav-link" href="#" onclick="$$.aUser.showModal(); return false">       <i class="large material-icons text-warning">person_add</i>   </a></li><li class="nav-item navbar-toggler-right" style="margin-right: 120px">   <a class="nav-link" href="#" onclick="$$.aUser.lockAll(null); return false">       <i class="large material-icons text-primary">lock_outline</i>   </a></li>'),$$.aUser.get()},getRowId:function(r){return r.attr("id").substring(10)},render:function(r){var e=$("#userTable tbody").html("");if(r.length>0)for(i=0;i<r.length;i++){var a=r[i];e.append('<tr id="userItemId'+a._id+'" data-password="'+a.password+'" data-username="'+a.username+'" data-role="'+a.role+'"data-active="'+a.active+'">   <td style="text-align:left">'+(i+1)+"</td>   <td "+(a.active?'style="width:auto; text-align: center;"':' style="color:gray; width:auto; text-align: center;"')+">"+a.username+'</td>   <td style="width:auto; text-align: center;">'+a.role+'</td>   <td class="text-center"><a href="#" onclick="$$.aUser.toggleActive(this, 2); return false">'+(a.active?this.activeSpan:this.unactiveSpan)+'</a></td>   <td class="text-center"><div style="display: inline-flex">       <a href="#" onclick="$$.aUser.showModalInfo(this, 3); return false" style="margin:0 3px">           <i class="large material-icons" style="color:black">edit</i>       </a>       <a href="#" onclick="$$.aUser.showModalPassword(this, 3); return false" style="margin:0 3px">           <i class="large material-icons" style="color:green">vpn_key</i>       </a>       <a href="#" onclick="$$.aUser.delete(this, 3); return false" style="margin:0 3px">           <i class="large material-icons" style="color:red">delete_forever</i>       </a>   </div></td></tr>')}},get:function(){$.ajax({type:"get",url:"/admin/user/getAll",success:function(r){0!=r.length&&void 0!=r[0]&&(r[0].active?($("#btnLockAll span").attr("style","color:blue;"),$("#btnLockAll span").attr("title","Lock")):($("#btnLockAll span").attr("style","color:gray;"),$("#btnLockAll span").attr("title","Unlock"))),$$.aUser.render(r)},error:function(){alert("Get all user have error !")}})},showModal:function(){$$.aUser.userId=null,$("#username").val(""),$("#password").val(""),$("#confirmPassword").val(""),$("#userRole").val("user"),$("#userActive").prop("checked",!0),$("#userModalError").html(""),$("#userModal").modal("show")},showModalInfo:function(r,e){r=$$.getRow(r,e),$$.aUser.userId=$$.aUser.getRowId(r),$("#newUsername").val(r.attr("data-username")),$("#newRole").val(r.attr("data-role")),$("#newActive").prop("checked","true"==r.attr("data-active")),$("#userInfoModalError").html(""),$("#userInfoModal").modal("show")},showModalPassword:function(r,e){r=$$.getRow(r,e),$$.aUser.userId=$$.aUser.getRowId(r),$("#newPassword").val(""),$("#confirmNewPassword").val(""),$("#userPasswordModalError").html(""),$("#userPasswordModal").off("shown.bs.modal").on("shown.bs.modal",function(){$("#username").focus()}).modal("show")},onModalKeyup:function(r){13===(r.which||r.keyCode)&&$$.aUser.save()},lockAll:function(){$.ajax({type:"PUT",url:"/admin/user/lockAll",success:function(r){r.err?(console.log(r.err),alert("Error: Lock all user has errors!")):$$.aUser.get()},error:function(){alert("Error: Lock all user has errors!")}})},saveNewPassword:function(){var r={id:$$.aUser.userId,password:$("#newPassword").val(),confirmPassword:$("#confirmNewPassword").val()};return""===r.password?($("#userPasswordModalError").html("The password is empty!"),void $("#newPassword").focus()):""===r.confirmPassword?($("#userPasswordModalError").html("The confirm password is empty!"),void $("#confirmNewPassword").focus()):r.password!=r.confirmPassword?($("#userPasswordModalError").html("The confirm password is different the password!"),void $("#confirmNewPassword").focus()):void $.ajax({type:"PUT",url:"/admin/user",data:r,dataType:"JSON",success:function(r){r.error?alert("Error: Save new password has errors!"+r.error):$$.aUser.get(),$("#userPasswordModal").modal("hide")},error:function(){alert("Error: Save new password has errors!"),$("#userPasswordModal").modal("hide")}})},save:function(){var r={id:$$.aUser.userId,username:$("#newUsername").val().trim(),role:$("#newRole").val().trim(),active:$("#newActive").prop("checked")};if(""===r.username)return $("#userModalError").html("The username is empty!"),void $("#newUsername").focus();$.ajax({type:"PUT",url:"/admin/user",data:r,dataType:"JSON",success:function(r){r.error?alert("Error: Save user has errors!"+r.error):$$.aUser.get(),$("#userInfoModal").modal("hide")},error:function(){alert("Error: Save user has errors!"),$("#userInfoModal").modal("hide")}})},addUser:function(){var r={id:$$.aUser.userId,username:$("#username").val().trim(),password:$("#password").val(),confirmPassword:$("#confirmPassword").val(),role:$("#userRole").val().trim(),active:$("#userActive").prop("checked")};return""===r.username?($("#userModalError").html("The username is empty!"),void $("#username").focus()):""===r.password?($("#userModalError").html("The password is empty!"),void $("#password").focus()):""===r.confirmPassword?($("#userModalError").html("The confirm password is empty!"),void $("#confirmPassword").focus()):r.password!=r.confirmPassword?($("#userModalError").html("The confirm password is different the password!"),void $("#confirmPassword").focus()):void $.ajax({type:"POST",url:"/admin/user",data:r,dataType:"JSON",success:function(r){r.error?alert("Error: Save user has errors!"+r.error):$$.aUser.get(),$("#userModal").modal("hide")},error:function(){alert("Error: Save user has errors!"),$("#userModal").modal("hide")}})},delete:function(r,e){r=$$.getRow(r,e);var a=this.getRowId(r),s=r.attr("data-username");console.log(a),$$.confirm("Delete user",'Are you sure you want to delete this user "'+s+'"?',function(){console.log("ok"),$.ajax({type:"DELETE",url:"/admin/user",data:{id:a},dataType:"JSON",success:function(r){r.error?$$.alert("Error: Delete user has errors!"):$$.aUser.get()},error:function(){$$.alert("Error: Delete user has errors!")}})})},toggleActive:function(r,e){r=$$.getRow(r,e);var a=this.getRowId(r),s=!$$.aUser.parseBool(r.attr("data-active"));$.ajax({type:"PUT",url:"/admin/user",data:{id:a,active:s},dataType:"JSON",success:function(e){e.error?(console.log(e.error),alert("Error: Update user has errors!")):(console.log(e),r.attr("data-active",e.item.active),r.children().eq(1).css("color",e.item.active?"":"gray"),r.children().eq(3).children().eq(0).html(e.item.active?$$.aUser.activeSpan:$$.aUser.unactiveSpan))},error:function(){$$.alert("Error: Update user has errors!")}})},parseBool:function(r){return"true"===r.toString().toLowerCase()}},$(document).ready($$.aUser.init);
!function(e){var t,i={completed:function(){},start:function(){},loaded:function(){},progress:function(){},error:function(){},upload_old:function(i,n){t.init();var o={fileno:-1,filename:i.attr("value").replace(/^.*[\\\/]/,""),perc:0,sent:0,total:0};t.start(o),e('<iframe id="'+n+'" name="'+n+'" src="#" style="display:none"></iframe>').appendTo("body"),e("#"+n).bind("load",function(){var i=e("#"+n).contents().find("body").html(),o=jQuery.parseJSON(i);o.fileno=-1,t.loaded(o),t.completed(),e("#"+n).unbind("load"),e("#"+n).remove()}),i.parent().submit()},upload:function(e){if(nfiles=e.length,cfiles=nfiles,t.init(),void 0!==e)for(var i=0;i<nfiles;i++){var n=e[i].name.toLowerCase().split(/\./);if(n=n[n.length-1],t.type&&-1==t.type.indexOf(n)){o={err_no:1,err_des:"File type error",fileno:i,filename:e[i].name};t.error(o),cfiles--,0==cfiles&&t.completed()}else if(t.maxsize>0&&e[i].size>1048576*t.maxsize){var o={err_no:2,err_des:"File size error",fileno:i,filename:e[i].name};t.error(o),cfiles--,0==cfiles&&t.completed()}else{var l={fileno:i,filename:e[i].name,perc:0,sent:0,total:0};t.start(l);try{var a=new XMLHttpRequest}catch(e){return alert("Your browser does not support AJAX!"),!1}a.open("POST",t.post_upload,!0),a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.upload.filenumb=i,a.filenumb=i,a.upload.filename=e[i].name,a.upload.addEventListener("progress",function(e){if(e.lengthComputable){var i=Math.ceil(e.loaded/e.total*100),n={fileno:this.filenumb,filename:this.filename,perc:i,sent:e.loaded,total:e.total};t.progress(n)}},!1),a.addEventListener("load",function(e){var i=jQuery.parseJSON(e.target.responseText);i.fileno=this.filenumb,t.loaded(i),cfiles--,0==cfiles&&t.completed()},!1);var r=new FormData;r.append("folder",t.folder),r.append("file_element",t.file_elem),r.append("udata",t.user_data),r.append(t.file_elem,e[i]),a.send(r)}}else alert("no support")}};e.fn.mfupload=function(n){t={init:i.init,start:i.start,loaded:i.loaded,progress:i.progress,completed:i.completed,ini_text:"Drag image to here",over_text:"Drop image",over_col:"white",over_bkcol:"green",post_upload:"cover/upload",maxsize:5,type:"",folder:"./",user_data:"",file_elem:""},n&&e.extend(t,n),this.each(function(){window.location==window.parent.location&&(t.file_elem="mf_file_"+e(this).attr("id"),t.iframe="mf_iframe_"+e(this).attr("id"),e(this).append('<div class="mf_upload_m"><form method="post" enctype="multipart/form-data" class="file" action="'+t.post_upload+'" target="'+t.iframe+'"><input type="file" class="file" name="'+t.file_elem+'" id="'+t.file_elem+'" multiple /><input type="hidden" name="folder" value="'+t.folder+'" /><input type="hidden" name="file_element" value="'+t.file_elem+'" /></form><div class="mf_upload_ins"></div></div>'),e(this).find(".mf_upload_m").css({position:"relative",margin:0,padding:0,width:"inherit",height:"inherit"}),e(this).find(".file").css({position:"relative","text-align":"right","-moz-opacity":"0",filter:"alpha(opacity: 0)",opacity:"0","z-index":"2",width:"100%",height:"100%",top:0,left:0}),e(this).find(".mf_upload_ins").css({position:"absolute","text-align":"center","z-index":"1",width:"100%",height:"100%",top:0,left:0}),e(this).find(".mf_upload_ins").empty().html(t.ini_text),e(this).bind({dragleave:function(i){i.preventDefault(),e(this).find(".mf_upload_ins").css("color","inherit"),e(this).find(".mf_upload_ins").css("background-color","inherit").html(t.ini_text)},drop:function(n){n.preventDefault(),e(this).find(".mf_upload_ins").css("color","inherit"),e(this).find(".mf_upload_ins").css("background-color","inherit").html(t.ini_text);var o=n.originalEvent;o.dataTransfer.files?i.upload(o.dataTransfer.files):alert("Drag and Drop not supported by your browser.")},dragover:function(i){i.preventDefault(),e(this).find(".mf_upload_ins").css("color",t.over_col),e(this).find(".mf_upload_ins").css("background-color",t.over_bkcol),e(this).find(".mf_upload_ins").html(t.over_text)}}),e(this).find("input[type=file]").bind("change",function(n){n.preventDefault(),n.target.files?i.upload(n.target.files):i.upload_old(e(this),t.iframe)}))})}}(jQuery);